<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curriculum - The Informatics Initiative</title>
    <link rel="stylesheet" href="styles.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>
        // IMMEDIATE AUTH CHECK (Client-side Page Protection)
        if (!localStorage.getItem('authToken')) {
            alert('You must be logged in to view this page.');
            window.location.href = '/Tii/login.html';
        }
    </script>
    <script src='/Tii/user-loader.js' defer></script>
</head>
<body>
    <header>
        <a href="/Tii/index.html">
        <div class="logo-container">
            <svg class="logo-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <polygon points="50,5 90,30 90,70 50,95 10,70 10,30" fill="transparent" stroke="#2a6e62" stroke-width="5"/>
                <circle cx="50" cy="50" r="10" fill="#2a6e62"/>
                <path d="M50 5 L50 95 M10 30 L90 70 M10 70 L90 30" stroke="#2a6e62" stroke-width="2"/>
            </svg>
            <h1>THE INFORMATICS INITIATIVE</h1>
        </div>
        </a>
        <nav class="main-nav">
            <a href="/Tii/curriculum.html">Curriculum</a>
            <a href="/Tii/lessons.html">Weekly Lessons</a>
            <a href="/Tii/portal.html">Student Portal</a>
            <a href="/Tii/feedback.html">Feedback</a>
        </nav>
        <a id="auth-button" href="/Tii/login.html" class="login-btn">Login</a>
    </header>

    <main>
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <h2 style="text-align: center; margin-bottom: 24px; color: #2a6e62;">Curriculum</h2>
            <p style="text-align:center; color:#555; margin-bottom:18px;">Below is a list of existing courses.</p>
            <div class="other-courses-grid" aria-label="Existing courses">
                <a class="other-course-card" href="/Tii/courses/programming.html" title="Programming">
                    <h4>Programming</h4>
                    <p>Hands-on programming fundamentals and practical coding projects.</p>
                    <span class="explore-btn-secondary" style="display:inline-block;width:auto;padding:8px 14px;margin-top:12px">Open</span>
                </a>
                <a class="other-course-card" href="/Tii/courses/data-analysis.html" title="Data Analysis">
                    <h4>Data Analysis</h4>
                    <p>Learn how to collect, clean, visualize, and interpret data.</p>
                    <span class="explore-btn-secondary" style="display:inline-block;width:auto;padding:8px 14px;margin-top:12px">Open</span>
                </a>
                <a class="other-course-card" href="/Tii/courses/drug-discovery.html" title="Drug Discovery">
                    <h4>Drug Discovery</h4>
                    <p>Explore computational approaches to identifying therapeutic candidates.</p>
                    <span class="explore-btn-secondary" style="display:inline-block;width:auto;padding:8px 14px;margin-top:12px">Open</span>
                </a>
                <a class="other-course-card" href="/Tii/courses/computational-chemistry.html" title="Computational Chemistry">
                    <h4>Computational Chemistry</h4>
                    <p>Modeling and simulation techniques for chemical systems.</p>
                    <span class="explore-btn-secondary" style="display:inline-block;width:auto;padding:8px 14px;margin-top:12px">Open</span>
                </a>
                <a class="other-course-card" href="/Tii/courses/bioinformatics.html" title="Bioinformatics">
                    <h4>Bioinformatics</h4>
                    <p>Computational analysis of biological sequence and omics data.</p>
                    <span class="explore-btn-secondary" style="display:inline-block;width:auto;padding:8px 14px;margin-top:12px">Open</span>
                </a>
            </div>
            <div style="text-align:center; margin-top:18px;">
                <a class="explore-btn-secondary" href="/Tii/other-courses.html">Other Courses</a>
            </div>
        </div>
        <script>
        // Fetch persisted courses that have placement === 'curriculum' and render them into the card grid
        (async function(){
            try {
                const API_URL = window.location.origin || 'http://localhost:3000';
                const resp = await fetch(`${API_URL}/api/courses`);
                if (!resp.ok) return;
                const data = await resp.json();
                if (!data.courses || !data.courses.length) return;
                const grid = document.querySelector('.other-courses-grid');
                if (!grid) return;

                // Badge configuration: page-specific defaults for Curriculum
                // You can override by setting window.ADDED_BADGE_TEXT and window.ADDED_BADGE_BG before this script runs
                const ADDED_BADGE_TEXT = (window.ADDED_BADGE_TEXT && String(window.ADDED_BADGE_TEXT)) || 'Add';
                // Use a distinct color for curriculum page uploaded badges (orange) unless explicitly overridden
                if (window.ADDED_BADGE_BG) {
                    try { document.documentElement.style.setProperty('--added-badge-bg', window.ADDED_BADGE_BG); } catch(e){}
                } else {
                    try { document.documentElement.style.setProperty('--added-badge-bg', '#ff8c42'); } catch(e){}
                }

                // Helper to create a card for a course (with thumbnail placeholder, badge, and admin Manage button)
                function createCourseCard(c){
                    const a = document.createElement('a');
                    a.className = 'other-course-card';
                    a.href = c.url || '#';
                    a.title = c.title || '';

                    // Mark uploaded/dynamic courses differently (created_by not 'static' or id pattern)
                    const isUploaded = (c.created_by && String(c.created_by).toLowerCase() !== 'static') || (c.id && String(c.id).startsWith('c_'));
                    if (isUploaded){
                        a.classList.add('uploaded');
                        const badge = document.createElement('span');
                        badge.className = 'course-badge';
                        badge.textContent = ADDED_BADGE_TEXT;
                        a.appendChild(badge);
                    }

                    // Thumbnail support (thumbnail, image_url, icon) â€” only render when present
                    const thumb = c.thumbnail || c.image_url || c.icon || '';
                    if (thumb) {
                        const img = document.createElement('img');
                        img.src = thumb;
                        img.alt = c.title || 'course';
                        img.style.objectFit = 'cover';
                        img.style.borderRadius = '6px';
                        img.style.marginBottom = '10px';
                        a.appendChild(img);
                    }

                    // Match static card structure: title, description, then actions
                    const h = document.createElement('h4'); h.textContent = c.title || 'Untitled';
                    const p = document.createElement('p'); p.textContent = c.description || '';
                    a.appendChild(h); a.appendChild(p);

                    // Actions container (keeps same visual structure as static cards)
                    const actionsWrap = document.createElement('div');
                    actionsWrap.style.display = 'flex';
                    actionsWrap.style.gap = '8px';
                    actionsWrap.style.alignItems = 'center';
                    actionsWrap.style.marginTop = '12px';

                        // uploaded/generated course: show single Open button that navigates to the course page
                        const openBtn = document.createElement('a');
                        openBtn.className = 'mini-cta manage-inline';
                        openBtn.textContent = 'Open';
                        // Prefer authoritative course.url if provided, else fallback to generated path
                        openBtn.href = c.url && c.url.trim() ? c.url : (`/Tii/courses/${encodeURIComponent(c.id)}.html`);
                        openBtn.target = '_blank';
                        actionsWrap.appendChild(openBtn);

                    // Admin-only actions for uploaded courses: visible when auth token exists
                    const token = localStorage.getItem('authToken');
                    if (token && c.id) {
                        // Admins can manage courses via the portal; remove inline "Add Lesson" CTA to avoid upload prompts here.
                        const manageBtn = document.createElement('a');
                        manageBtn.className = 'mini-cta manage-inline';
                        manageBtn.textContent = 'Manage';
                        manageBtn.href = '/Tii/admin-portal.html?edit_course=' + encodeURIComponent(c.id);
                        actionsWrap.appendChild(manageBtn);
                    }
                    // attach actions and return the card element
                    a.appendChild(actionsWrap);
                    return a;
                }
                // Filter courses and render them; exclude admin/system placeholder titles
                function placementIsCurriculum(p){
                    if (!p && p !== 0) return true; // treat missing placement as curriculum-friendly
                    const v = String(p).trim().toLowerCase();
                    return v === 'curriculum' || v === 'list' || v === 'display as list' || v.indexOf('curr') !== -1;
                }

                // Only show the canonical curriculum courses on this page.
                // Any other added courses will remain reachable from "Other Courses".
                const ALLOWED_TITLES = new Set([
                    'programming',
                    'data analysis',
                    'drug discovery',
                    'computational chemistry',
                    'bioinformatics'
                ]);

                data.courses
                    .filter(c => placementIsCurriculum(c.placement) && c.title && c.title.trim() !== '' )
                    // limit to the canonical set (case-insensitive)
                    .filter(c => ALLOWED_TITLES.has((c.title||'').trim().toLowerCase()))
                    .forEach(c => {
                        // avoid duplicates by title
                        const exists = Array.from(grid.querySelectorAll('.other-course-card')).some(card => card.querySelector('h4') && card.querySelector('h4').textContent.trim() === (c.title||'').trim());
                        if (exists) return;
                        const card = createCourseCard(c);
                        grid.appendChild(card);
                    });
            } catch (e) { console.error('Failed to load curriculum courses', e); }
        })();
        </script>
    </main>

    <footer>
        <div class="copyright-bar" style="border-top: none; padding-top: 0; flex-direction: column;">
            
            <div class="social-links" style="padding-bottom: 15px;">
                <a href="https://www.linkedin.com/company/informatics" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://www.twitter.com/informatics" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="https://www.instagram.com/informatics" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://www.youtube.com/informatics" target="_blank"><i class="fab fa-youtube"></i></a>
                <a href="https://www.facebook.com/informatics" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.tiktok.com/@informatics" target="_blank"><i class="fab fa-tiktok"></i></a>
            </div>
            <p>&copy; 2024 The Informatics Initiative. All rights reserved.</p>
        </div>
    </footer>
   <script type="module">
    import { handleAuthButton, updatePortalLink } from '/Tii/auth.js';
    updatePortalLink();
    handleAuthButton();
</script>
</body>
</html>