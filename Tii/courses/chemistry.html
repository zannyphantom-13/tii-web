<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Computational Chemistry â€” The Informatics Initiative</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        <a href="../index.html">
            <div class="logo-container">
                <h1>THE INFORMATICS INITIATIVE</h1>
            </div>
        </a>
        <nav class="main-nav">
            <a href="../curriculum.html">Curriculum</a>
            <a href="../lessons.html">Weekly Lessons</a>
            <a href="../portal.html">Student Portal</a>
            <a href="../feedback.html">Feedback</a>
        </nav>
        <a id="auth-button" href="../login.html" class="login-btn">Login</a>
    </header>

    <main>
        <h2>Computational Chemistry</h2>
        <p id="course-description">A pathway exploring computational approaches in chemistry.</p>

        <div id="course-actions" style="margin-bottom:16px;">
            <!-- Admin links will be injected here when JWT present -->
        </div>

        <div id="lessons" class="lesson-list">
            Loading lessons...
        </div>
    </main>

    <footer>
        <p>&copy; 2024 The Informatics Initiative</p>
    </footer>

    <script>
    (async function(){
        const COURSE_ID = 'chemistry';
        const apiBase = window.location.origin || 'http://localhost:3000';
        const rl = document.getElementById('lessons');

        function renderLessons(list){
            if(!list || !list.length){ rl.innerHTML = '<p>No lessons yet.</p>'; return; }
            rl.innerHTML = '';
            list.forEach(ls => {
                const el = document.createElement('div');
                el.className = 'lesson-card';
                el.innerHTML = `
                    <h3>${ls.title || 'Untitled'}</h3>
                    ${ls.topic? `<p><strong>Topic:</strong> ${ls.topic}</p>` : ''}
                    ${ls.weeks? `<p><strong>Weeks:</strong> ${ls.weeks}</p>` : ''}
                    ${ls.date? `<p><strong>Date:</strong> ${ls.date}</p>` : ''}
                    ${ls.other_info? `<p>${ls.other_info}</p>` : ''}
                    ${ls.image_url? `<img src="${ls.image_url}" alt="${ls.title}" style="max-width:300px;display:block;margin-top:8px;"/>` : ''}
                    <div>${ls.content || ''}</div>
                `;
                rl.appendChild(el);
            });
        }

        try{
            const res = await fetch(`${apiBase}/api/courses/${COURSE_ID}/lessons`);
            if(res.ok){
                const data = await res.json();
                renderLessons(data.lessons || data);
            } else {
                rl.innerHTML = '<p>Failed to load lessons.</p>';
            }
        }catch(e){ rl.innerHTML = '<p>Error loading lessons.</p>'; console.error(e) }

        // show admin actions when token exists
        const token = localStorage.getItem('token') || localStorage.getItem('authToken');
        if(token){
            const actions = document.getElementById('course-actions');
            actions.innerHTML = `
                <a class="btn" href="../upload-lesson.html?course=${COURSE_ID}">Add Lesson</a>
                <a class="btn" href="../delete-lesson.html?course=${COURSE_ID}">Manage Lessons</a>
            `;
        }
    })();
    </script>
    <script type="module">
        import { handleAuthButton, updatePortalLink } from '../auth.js';
        updatePortalLink();
        handleAuthButton();
    </script>
</body>
</html>
